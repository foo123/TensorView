/**
*  TensorView
*  View array data as multidimensional tensors of various shapes efficiently
*  @VERSION 1.0.0
*  https://github.com/foo123/TensorView
*
**/
!function(n,t){"use strict";"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(function(n){return t()}):n.TensorView=t()}("undefined"!=typeof self?self:this,function(n){"use strict";var t="prototype",S=Math;function k(s,n,t){if(!(this instanceof k))return new k(s,n,t);var l,o=this,u=!1,f=!1,a=null,c=null,h=null,p=-1,g=null,d=null,y=0,w=null,_=null,v=null,e=0;function m(n,t,r,e,i,o){var l,s,u=0;if(r)if(o)for(l=t-1;0<=l;--l)s=n[l],u=(u*=e[l])+(o[l].start+((s<0?i[l]:0)+s)*o[l].step);else for(l=t-1;0<=l;--l)s=n[l],u=(u*=e[l])+((s<0?i[l]:0)+s);else if(o)for(l=0;l<t;++l)s=n[l],u=(u*=e[l])+(o[l].start+((s<0?i[l]:0)+s)*o[l].step);else for(l=0;l<t;++l)s=n[l],u=(u*=e[l])+((s<0?i[l]:0)+s);return u}function A(n,t,r,e,i,o,l){var s,u;if(l=l||new Array(t),r)if(o)for(s=0;s<t;++s)u=n%e[s],n=S.floor(n/e[s]),l[s]=S.floor((u-o[s].start)/o[s].step);else for(s=0;s<t;++s)u=n%e[s],n=S.floor(n/e[s]),l[s]=u;else if(o)for(s=t-1;0<=s;--s)u=n%e[s],n=S.floor(n/e[s]),l[s]=S.floor((u-o[s].start)/o[s].step);else for(s=t-1;0<=s;--s)u=n%e[s],n=S.floor(n/e[s]),l[s]=u;return l}function b(n,t,r){for(var e=n,i=t.length-1,o=0;o<i;++o)e=e[t[o]];return 2<arguments.length&&(e[t[i]]=r),e[t[i]]}function j(n,t){if(c)return a?c[1]?a(c[0].get(t),c[1].get(t)):a(c[0].get(t)):c[0].get(c[0].indices(n));if(!h)return d?b(s,A(n,d.length,!1,d,0,null,g)):f?s:s[n];for(var r=0;r<y;++r)g[r]=_[r].start+t[r]*_[r].step;for(var e,i,r=0,o=h.length;r<o;++r){if(i=(e=h[r]).size(p),0<=g[p]&&g[p]<i)return e.get(g);g[p]-=i}}if(n=n||{},u=!!t&&!!t._transposed,t&&t._refs&&t._refs[0]instanceof k)u=!1,a=t._op||null,c=t._refs,e=c[0].length(),w=(a?c[0].size():n.shape)||c[0].size(),y=w.length,c[1]&&(s=null),a&&n.slice&&(n.slice=null);else if(t&&t._stack&&2<=t._stack.length&&t._stack[0]instanceof k&&t._stack[1]instanceof k)s=null,p=t._stack_axis||0,h=t._stack,(w=h[0].size())[p]=V(h.map(function(n){return n.size(p)})),e=V(h.map(function(n){return n.length()})),y=w.length,g=new Array(y);else{var e=function(n){{if(Array.isArray(n))return 1;if("undefined"!=typeof Float32Array&&n instanceof Object.getPrototypeOf(Float32Array))return 1}return}(s)?(f=!1,n.ndarray&&n.ndarray.length?(d=n.ndarray,g=new Array(d.length),T(d)):s.length):(f=!0,1),r=T(w=(w=n.shape)&&w.length?w:[e]);if(r!==(e=f?r:e))throw"TensorView:shape ["+w.join(",")+"] does not match size "+String(e);y=w.length}if((_=n.slice)&&_.length){for(;_.length<y;)_.push(null);_.length>y&&(_.length=y);for(x=0;x<y;++x){var i=_[x]||{start:0,stop:w[x]-1,step:1};_[x]=z._indices(w[x],i.start,i.stop,i.step)}}else for(var _=new Array(y),x=0;x<y;++x)_[x]=new z(0,w[x]-1,1);for(v=new Array(y),x=0;x<y;++x)v[x]=_[x].count(w[x]);l=y?T(v):0,n=t=null,o.dispose=function(){v=_=w=s=d=g=h=c=a=null},o.data=function(){return s},o.dimension=function(){return y},o.shape=function(n){return arguments.length?w[n]:w.slice()},o.slicing=function(n){return arguments.length?_[n].toObj():_.map(function(n){return n.toObj()})},o.size=function(n){return arguments.length?v[n]:v.slice()},o.length=function(){return l},o.index=function(){return m(Array.isArray(arguments[0])?arguments[0]:arguments,y,u,w,v,_)},o.indices=function(n){return A(n,y,u,w,0,_)},o.iterator=function(){var t,r,e=0<l?y-1:-1,i=0<l?new Array(y).fill(0):null,o=i?new Array(y):null;return{next:function(){if(e<0)return{done:!0};for(r=m(i,y,u,w,v,_),t=0;t<y;++t)o[t]=i[t];for(var n=[j(r,i),o];0<=e&&i[e]+1>=v[e];)--e;if(0<=e)for(++i[e];e+1<y;)i[++e]=0;return{value:n}}}},o.forEach=function(n){if(0<l&&"function"==typeof n)for(var t=new Array(y).fill(0),r=t.slice(),e=y-1;;){if(!1===n(j(m(t,y,u,w,v,_),t),r,s,o))return;for(;0<=e&&t[e]+1>=v[e];)--e;if(e<0)return;for(++t[e],r[e]=t[e];e+1<y;)t[++e]=0,r[e]=0}},o.indexOf=function(r,e){e=e||O;var i=null;return o.forEach(function(n,t){if(e(r,n))return i=t,!1}),i},o.slice=function(r){return new k(s,{ndarray:d,shape:a&&c?null:w,slice:a&&c?null:_.map(function(n,t){return z._subslice(n,r[t],!0)})},{_transposed:u,_refs:a&&c?c.map(function(n){return n.slice(r)}):c,_op:a,_stack:c?null:h,_stack_axis:p})},o.reshape=function(n){return new k(s,{shape:n},{_refs:[o]})},o.concat=function(r,e){e=e||0;for(var i=0,n=(r=r instanceof k?[r]:r).length;i<n;++i)if(v.filter(function(n,t){return t===e||n===r[i].size(t)}).length!==v.length)throw"TensorView::concat:["+v.map(function(n,t){return e===t?":":n}).join(",")+"] and ["+r[i].size().map(function(n,t){return e===t?":":n}).join(",")+"] sizes do not match!";return new k(null,null,{_stack:[o].concat(r),_stack_axis:e})},o.get=function(n){if(n.length<y)throw"TensorView::get:indices do not match shape!";var t=h?0:m(n,y,u,w,v,_);if(t<0||e<=t)throw"TensorView::get:index out of data bounds!";return j(t,n)},o.set=function(n,t){if(n.length<y)throw"TensorView::set:indices do not match shape!";var r=h?0:m(n,y,u,w,v,_);if(r<0||e<=r)throw"TensorView::set:index out of data bounds!";return function(n,t,r){if(c)a||c[0].set(c[0].indices(n),r);else if(h){for(var e=0;e<y;++e)g[e]=_[e].start+t[e]*_[e].step;for(var i,o,e=0,l=h.length;e<l;++e){if(o=(i=h[e]).size(p),0<=g[p]&&g[p]<o)return i.set(g,r);g[p]-=o}}else d?b(s,A(n,d.length,!1,d,0,null,g),r):s[n]=r}(r,n,t),o},o.transpose=function(){return new k(s,{ndarray:d,shape:w.slice().reverse(),slice:_.map(function(n){return n.toObj()}).reverse()},{_transposed:!u,_refs:c?c.map(function(n){return n.transpose()}).reverse():null,_op:a,_stack:h?h.map(function(n){return n.transpose()}):null,_stack_axis:h?y-1-p:-1})},o.op=function(n,t){return new k(s,null,{_refs:t instanceof k?[o,t]:[o],_op:n})},o.toArray=function(n){var t=new(n||Array)(l),r=0;return o.forEach(function(n){t[r++]=n}),t},o.toNDArray=function(){var l=new Array(v[0]);return o.forEach(function(n,t){for(var r,e=l,i=y-1,o=0;o<i;++o)null==e[r=t[o]]&&(e[r]=new Array(v[o+1])),e=e[r];e[t[i]]=n}),l},o.toString=function(l){var s,u,f,a="",c=-1/0,h=null,p="";return null!=l?(s=l>>>1,2<=y?(u=v.map(function(n){return l<n}),f=function(n,t){return!u[t]||t<=y-3&&(n<s||n>v[t]-1-s)||y-3<t&&(n<=s||n>=v[t]-1-s)},h=new Array(u[v.length-2]?l+1:v[v.length-2]).fill(null).map(function(n){return new Array(u[v.length-1]?l+1:v[v.length-1])}),o.forEach(function(n,t){t.length===t.filter(f).length&&(c=S.max(String(n).length,c))}),o.forEach(function(n,t){if(t.length===t.filter(f).length){var r=t[y-2],e=t[y-1];if(u[y-2]&&s<r&&(r=l-(v[y-2]-1-r)),u[y-1]&&s<e&&(e=l-(v[y-1]-1-e)),h[r][e]=E(String(n),c," ",!1),v[y-1]===1+t[y-1]&&v[y-2]===1+t[y-2]){a+=p+h.map(function(n,t){return u[y-2]&&s===t&&(n=new Array(n.length).fill(E(":",c," ",!1))),u[y-1]&&(n[s]=E("..",c," ",!1)),n.join(" ")}).join("\n");for(var i=y-3,o=-1;0<=i;)o=-1===o&&u[i]&&t[i]+1===s?i:o,--i;p=-1===o?"\n-\n":"\n-\n"+E(":",c," ",!1)+" "+new Array((u[y-1]?l+1:v[y-1])-2).fill(E("..",c," ",!1)).join(" ")+" "+E(":",c," ",!1)+"\n-\n"}}})):a=l>=v[0]?o.toString():o.slice([{start:0,stop:s+1}]).toString()+" .. "+o.slice([{start:v[0]-1-s,stop:v[0]-1}]).toString()):2<=y?(h=new Array(v[v.length-2]).fill(null).map(function(n){return new Array(v[v.length-1])}),o.forEach(function(n){c=S.max(String(n).length,c)}),o.forEach(function(n,t){h[t[y-2]][t[y-1]]=E(String(n),c," ",!1),v[y-1]===1+t[y-1]&&v[y-2]===1+t[y-2]&&(a+=p+h.map(function(n){return n.join(" ")}).join("\n"),p="\n-\n")})):o.forEach(function(n){a+=(a.length?" ":"")+String(n)}),a}}function z(n,t,r){if(!(this instanceof z))return new z(n,t,r);this.start=null==n?null:n,this.stop=null==t?null:t,this.step=null==r?null:r}function E(n,t,r,e){t=n.length<t?new Array(t-n.length+1).join(r):"";return e?n+t:t+n}function O(n,t){return n===t}function r(n,t){return n+t}function e(n,t){return n*t}function V(n){return n.reduce(r,0)}function T(n){return n.reduce(e,1)}return k.VERSION="1.0.0",k[t]={constructor:k,dispose:null,data:null,dimension:null,shape:null,slicing:null,size:null,length:null,index:null,indices:null,iterator:null,forEach:null,indexOf:null,slice:null,reshape:null,concat:null,get:null,set:null,transpose:null,op:null,toArray:null,toNDArray:null,toString:null},"undefined"!=typeof Symbol&&void 0!==Symbol.iterator&&(k[t][Symbol.iterator]=function(){return this.iterator()}),z[t]={constructor:z,start:null,stop:null,step:null,clone:function(){return new z(this.start,this.stop,this.step)},indices:function(n){return z._indices(n,this.start,this.stop,this.step)},count:function(n){return z._count(n,this.start,this.stop,this.step)},subslice:function(n){return z._subslice(this,n)},toObj:function(){return{start:this.start,stop:this.stop,step:this.step}}},z._indices=function(n,t,r,e){return new z(t=null==t?0:(t<0?n:0)+t,r=t+(e=e||1)*S.floor(S.abs((r=null==r?n-1:(r<0?n:0)+r)-t)/S.abs(e)),e)},z._count=function(n,t,r,e){return!n||e<0&&(t<0||t<r)||0<e&&(n<=t||r<t)?0:S.min(n,S.ceil((S.abs(r-t)+1)/S.abs(e)))},z._subslice=function(n,t,r){var e=n.step||1;return r?t?{start:n.start+t.start*e,stop:n.start+t.stop*e,step:(t.step||1)*e}:n instanceof z?n.toObj():n:t?new z(n.start+t.start*e,n.start+t.stop*e,(t.step||1)*e):n instanceof z?n:new z(n.start,n.stop,e)},k.slice=z,k});